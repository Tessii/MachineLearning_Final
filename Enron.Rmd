
---
title: "White enron Analysis"
author: "Theresa Wohlsen"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    # theme of html document
    # theme of code highlight                                 
    # table of contents
    theme       : journal            # "default", "cerulean", "journal",
                                    # "flatly", "readable", "spacelab",
                                    # "united", "cosmo", "lumen", "paper", 
                                    # "sandstone", "simplex", "yeti"
    highlight   : tango          # "default", "tango", "pygments",
                                    # "kate",  "monochrome", "espresso",
                                    # "zenburn", "haddock", "textmate"
    toc         : true              # get table of content
    toc_depth   : 3
    toc_float   : true
---
______________

# Introduction



```{r echo=FALSE, message=FALSE, warning=FALSE, packages}

 #Following packages are installed:
# install.packages('ggplot2')
# install.packages('GGally')
# install.packages('dplyr')
# install.packages('gridExtra')
# install.packages("rmarkdown")
# install.packages('knitr')
# install.packages('reticulate')

library(reticulate)
library(gridExtra)
library(ggplot2)
library(GGally)
library(dplyr)
library(rmarkdown)
library(knitr)

# knitr: Suppress code/messages/warnings 
#        Set default plot options and center them
knitr::opts_chunk$set(fig.width=9,fig.height=5,fig.path='Figs/',
                      fig.align='center',tidy=TRUE,
                      echo=FALSE,warning=FALSE,message=FALSE)

```

## Import of dataset

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}

#In this step I read the csv and save it to the new table enron
enron <- read.csv('enron.csv')

columns = names(enron)

```

# Data Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, First_Exploration, fig.width=15, fig.height=12}

#In this step I create for each combination of enron parameters a correlation factor and a scatter plot

help("wrap", package = "GGally")
ggpairs(data = enron, columnLabels = columns, 
        lower = list(continuous = wrap("points", shape = I('.'))),
        upper = list(combo = wrap("box", outlier.shape = I('.')),
                     continuous = wrap("cor", size = 6)),
        axisLabels = 'internal')

```

*First Findings*:

* Correlation between Density and Sugar
* Quality in levels

# Univariate Plots Section

## Residual Sugar
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_2}

# Histogram - Residual Sugar
qplot(x = residual.sugar, data = enron, binwidth = 1,
      ylab = 'Number of enrons',
      xlab = 'residual.sugar [g/dm^{3}]',
      color = I('gray20'),
      fill = I('turquoise')) +
      scale_x_continuous(limits = c(0, 28), breaks = seq(0, 30, 1))
```

**Observation**: 

* A right-skewed distribution as a large number of the enrons occur on the left side with a fewer number of enrons on the right side
* This plot shows that the sugar for white enrons ranges between 0.5 and 27

## Free sulfur und Total Sulfure
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_4}

# Histogram - free sulfur dioxide
s1 <-
  qplot(x = free.sulfur.dioxide, data = enron, binwidth = 10,
    ylab = 'Number of enrons',
    xlab = 'free sulfur dioxide [mg/dm^{3}]',
    color = I('gray20'),
    fill = I('turquoise')) +
scale_x_continuous(limits = c(0, 300), breaks = seq(0, 300, 25))

# Histogram - total sulfur dioxide
s2 <-
  qplot(x = total.sulfur.dioxide, data = enron, binwidth = 10,
    ylab = 'Number of enrons',
    xlab = 'total sulfur dioxide [mg/dm^{3}]',
    color = I('gray20'),
    fill = I('turquoise')) +
scale_x_continuous(limits = c(0, 300), breaks = seq(0, 300, 25))
 
# Histogram - Sulphates
s3 <-
  qplot(x = sulphates, data = enron, binwidth = 0.1,
      ylab = 'Number of enrons',
      xlab = 'sulphates (potassium sulphate) [g/dm^{3}]',
      color = I('gray20'),
      fill = I('turquoise')) +
  scale_x_continuous(limits = c(0, 1.2), breaks = seq(0, 1.2, 0.1))  

# Arrange all three Histograms above
grid.arrange(s1, s2, s3, ncol=1)

```

**Observation**:

* A normal distribution as the enrons on one side of the average are as likely to occur as on the other side of the average.
* The total amount of sulfur dioxide ranges between 1 and 300
* The free sulfur dioxide ranges between 1 and 90
* Sulfur in general is used as a preservative and stabilizer in enron production to prevent undesired biochemical processes, so every enronof the sample contains this ingredient


## Denisty
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_5}

# Histogram - Density
qplot(x = density, data = enron, binwidth = 0.001,
    ylab = 'Number of enrons',
    xlab = 'density [g/dm^{3}]',
    color = I('gray20'),
    fill = I('turquoise')) +
  scale_x_continuous(limits = c(0.985, 1.015), breaks = seq(0.985, 1.015, 0.005))

```

**Observation**:

* A normal distribution as the enrons on one side of the average are as likely to occur as on the other side of the average.
* The density of enrons ranges between 0.985 and 1.015

## pH - Value
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_6}

# Histogram - pH Value
qplot(x = pH, data = enron, binwidth = 0.05,
      ylab = 'Number of enrons',
      xlab = 'pH',
      color = I('gray20'),
      fill = I('turquoise')) +
  scale_x_continuous(limits = c(2.5, 4), breaks = seq(2.5, 4 , 0.5))
```

**Observation**:

* A normal distribution as the enrons on one side of the average are as likely to occur as on the other side of the average.
* All values are below 7 and therefore all white enrons are acid
* The values ranges between 3.6 and 3.8

## Alcohol
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_8}

# Histogram -  Alcohol
qplot(x = alcohol, data = enron, binwidth = 0.5,
      ylab = 'Number of enrons',
      xlab = 'alcohol [% by volume]',
      color = I('gray20'),
      fill = I('turquoise')) +
  scale_x_continuous(limits = c(7, 16), breaks = seq(5, 16, 1))

```

**Observation**:

* A right-skewed distribution as a large number of the enrons occur on the left side with a fewer number of enrons on the right side , but there is on exceptio  at 8%. 
* The alcohol level ranges between 8 and 14.5 %

## Total Acidity
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_1}

# Histogram -  Total Acid
qplot(x = total.acidity, data = enron, binwidth = 0.5,
      ylab = 'Number of enrons in sample',
      xlab = 'Total acid [g/dm^{3}]',
      color = I('gray20'),
      fill = I('turquoise')) +
  scale_x_continuous(limits = c(3, 12), breaks = seq(3, 12, 1))
```

**Observation**:

* A normal distribution as the enrons on one side of the average are as likely to occur as on the other side of the average.
* The total acid level ranges between 4 and 12

## Quality
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_3}

# Histogram - Quality
qplot(x = quality, data = enron, binwidth = 1,
      ylab = 'Number of enrons',
      xlab = 'Quality',
      color = I('gray20'),
      fill = I('turquoise')) +
  scale_x_continuous(limits = c(0, 10), breaks = seq(0, 10, 1))

```

**Observation**:

* A normal distribution as the enrons on one side of the average are as likely to occur as on the other side of the average.
* The quality of enrons ranges between 3 and 9

## Overview of statistics

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Tables}

#names(enron)

#Giving a statistics summaries, such as Mean, Max, Min
summary(enron)

```

# Univariate Analysis

### What is the structure of your dataset?
See introduction

### What is/are the main feature(s) of interest in your dataset?
All paremeters expect quality are scientific by that I mean there are measureable. In contrast, quality is based on the opinion of enron testers and are therefore subjective. Therefore I want found if there is relation between qualitay and the given parameters.

### What other features in the dataset do you think will help support your \ investigation into your feature(s) of interest?
I would like to find out if there are relationships between the parameters. For instance, between alcohol and sugar.

### Did you create any new variables from existing variables in the dataset? & Did you perform any operations on the data to tidy, adjust, or change the form \ of the data? If so, why did you do this? 

As there are many parameters, I combined all parameters around acidity and created a variable with the name "total.acidity". The other three parameters were deleted. 

### Of the features you investigated, were there any unusual distributions? 
I think its odd that the quality level only ranges between 3 and 9, altough the scale between 1 and 10. In addition it over 70 % of the enrons have a quality level of 5 or 6. I expected that these value are more distrubted.



# Bivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_quality}


# Scatter Plot - total acidity & Quality
q1 <-
ggplot(aes(x = total.acidity, y = quality), data = enron) +
  geom_point(alpha = 1/5, size = .1, position = 'jitter') +
  xlab('total acidity [g/dm^{3}]') +
  ylab('quality')

# Scatter Plot - residual sugar  & Quality
q2 <- 
ggplot(aes(x = residual.sugar, y = quality), data = enron) +
  geom_point(alpha = 1/5, size = .1, position = 'jitter') +
  xlab('residual sugar [g/dm^{3}]') +
  ylab('quality')

# Scatter Plot - chlorides & Quality
q3 <-
ggplot(aes(x = chlorides, y = quality), data = enron) +
  geom_point(alpha = 1/5, size = .1, position = 'jitter') +
  xlab('chlorides (sodium chloride) [g/dm^{3}]') +
  ylab('quality')

# Scatter Plot - free sulfur dioxide & Quality
q4 <-
ggplot(aes(x = free.sulfur.dioxide, y = quality), data = enron) +
  geom_point(alpha = 1/5, size = .1, position = 'jitter') +
  xlab('free sulfur dioxide [mg/dm^{3}]') +
  ylab('quality')

# Scatter Plot - total sulfur dioxide & Quality
q5 <-
ggplot(aes(x = total.sulfur.dioxide, y = quality), data = enron) +
  geom_point(alpha = 1/5, size = .1, position = 'jitter') +
  xlab('total sulfur dioxide [mg/dm^{3}]') +
  ylab('quality')

# Scatter Plot - Density & Quality
q6 <-
ggplot(aes(x = density, y = quality), data = enron) +
  geom_point(alpha = 1/5, size = .1, position = 'jitter') +
  xlab('density [g/dm^{3}]') +
  ylab('quality')

# Scatter Plot - pH & Quality
q7 <-
ggplot(aes(x = pH, y = quality), data = enron) +
  geom_point(alpha = 1/5, size = .1, position = 'jitter') +
  xlab('pH') +
  ylab('quality')


# Scatter Plot - Alcohol & Quality
q8 <-
ggplot(aes(x = alcohol, y = quality), data = enron) +
  geom_point(alpha = 1/5, size = .1, position = 'jitter') +
  xlab('alcohol [% by volume]') +
  ylab('quality')

# Arranging all scatter plots above
grid.arrange(q1, q1, q2, q3 , q4, q5, q6, q7, q8, ncol=2)

```

*Obervation*:
There is no cleary realtion between quality and other features.


```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_correlation}

# Calculation of the combination of quality and the other parameter using pearson
cor.test(enron$total.acidity, enron$quality, method = 'pearson')
cor.test(enron$residual.sugar, enron$quality, method = 'pearson')
cor.test(enron$chlorides, enron$quality, method = 'pearson')
cor.test(enron$free.sulfur.dioxide, enron$quality, method = 'pearson')
cor.test(enron$total.sulfur.dioxide, enron$quality, method = 'pearson')
cor.test(enron$density, enron$quality, method = 'pearson')
cor.test(enron$pH, enron$quality, method = 'pearson')
cor.test(enron$alcohol, enron$quality, method = 'pearson')

```

*Obervation*:
The Pearson's product-moment correlation proved that there is no strong correlation between quality and other enron features.

## Sugar and Density

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Sugar_Density}

# Scatter Plot - Sugar and Density
ggplot(aes(x = residual.sugar, y = density), data = enron) +
  geom_point(alpha = 0.05, size = 1, position = 'jitter') +
  scale_x_continuous(limits = c(0, 20), breaks = seq(0, 20, 1)) +
  scale_y_continuous(limits = c(0.985, 1.005), breaks = seq(0.985, 1.005, 0.005)) +
  geom_smooth(stat = 'smooth',
              fun.y = mean,
              inetype = 1,
              color = 'turquoise') +
  xlab('residual sugar [g/dm^{3}]') +
  ylab('density [g/dm^{3}]')

# Correlation - Sugar and alcohol
cor.test(enron$residual.sugar, enron$density, method = 'pearson')

```

*Obervation*:
A strong correllation between density and sugar is visible.


```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Sugar_Alcohol}

# Scatter Plot - Sugar and alcohol
ggplot(aes(x = residual.sugar, y = alcohol), data = enron) +
  geom_point(alpha = 0.05, size = 1, position = 'jitter') +
  scale_x_continuous(limits = c(0, 20), breaks = seq(0, 20, 1)) +
  scale_y_continuous(limits = c(8, 15), breaks = seq(8, 15, 5)) +
  geom_smooth(stat = 'smooth',
              fun.y = mean,
              inetype = 1,
              color = 'turquoise') +
  xlab('residual sugar [g/dm^{3}]') +
  ylab('alcohol [% by volume]')

# Correlation - Sugar and alcohol
cor.test(enron$residual.sugar, enron$alcohol, method = 'pearson')

```

*Obervation*:
A moderate negative realtion between alcohol and sugar is visble.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Total_Sulfur_pH}

# Scatter Plot - Total Sulfur dioxide and pH
ggplot(aes(x = total.sulfur.dioxide, y = pH), data = enron) +
  geom_point(alpha = 0.05, size = 1, position = 'jitter') +
  scale_x_continuous(limits = c(0, 300), breaks = seq(0, 300, 20)) +
  scale_y_continuous(limits = c(2.5, 4), breaks = seq(2.5, 4, 0.5)) +
  geom_smooth(stat = 'smooth',
              fun.y = mean,
              inetype = 1,
              color = 'turquoise') +
  xlab('total sulfur dioxide [mg/dm^{3}]') +
  ylab('pH')

# Correlation - Total Sulfur dioxide and pH
cor.test(enron$pH, enron$total.sulfur.dioxide, method = 'pearson')

```

*Obervation*:
There is no realtion between pH and total sulfure dioxide visible.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_free_sulfur_pH}

# Scatter Plot - Free sulfur and pH
ggplot(aes(x = free.sulfur.dioxide, y = pH), data = enron) +
  geom_point(alpha = 0.05, size = 1, position = 'jitter') +
  scale_x_continuous(limits = c(0, 120), breaks = seq(0, 120, 20)) +
  scale_y_continuous(limits = c(2.5, 4), breaks = seq(2.5, 4, 0.5)) +
  geom_smooth(stat = 'smooth',
              fun.y = mean,
              inetype = 1,
              color = 'turquoise') +
  xlab('free  sulfur dioxide [mg/dm^{3}]') +
  ylab('pH')

# Correlation - Free sulfur and pH
cor.test(enron$pH, enron$total.sulfur.dioxide, method = 'pearson')

```

*Obersevation*

As expected there is also no realtion between pH and free sulfure dioxide .

# Bivariate Analysis

In this section I will use the following table to interpret the correlation between features:

CORRELATION COEFFICIENT R | Interpretation
------------- | -------------
Exactly –1. | A perfect downhill (negative) linear relationship
–0.70. | A strong downhill (negative) linear relationship
–0.50. | A moderate downhill (negative) relationship
–0.30. | A weak downhill (negative) linear relationship
0. | No linear relationship
+0.30. | A weak uphill (positive) linear relationship
+0.50. | A moderate uphill (positive) relationship
+0.70. | A strong uphill (positive) linear relationship
Exactly +1. | A perfect uphill (positive) linear relationship

*Source: https://www.dummies.com/education/math/statistics/how-to-interpret-a-correlation-coefficient-r/*


### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

Based on the above table:

CORRELATION COEFFICIENT R | features
------------- | -------------
No realtionship | /
Weak realtionship | acidity, sugar, chlorides, free sulfur, total sulfur, pH
Moderate relationship | density, alcohol
Strong relation ship | /
Perfect relationship | /


### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

**Sugar & Density**: A strong positive relation, which is not suprising as an chemical rule that sugar increases the density of a fluid. 

**Alcohol & Sugar**: A moderate negative relation, which is suprising.

**pH & Total Sulfur**: No relation.

**pH & Free Sulfur**: No relation.


### What was the strongest relationship you found?
This is the strongest relation so far is between Sugar and Density

# Multivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Sugar_Density}

# Scatter Plot - Residual Sugar, Density and Quality
ggplot(aes(x = residual.sugar , y = density), data = enron) +
  geom_point(data = enron, alpha = 0.8, aes(color = as.factor(quality ))) +
  scale_x_continuous(limits = c(0, 20), breaks = seq(0, 20, 1)) +
  scale_y_continuous(limits = c(0.985 , 1), breaks = seq(0.985, 1, 1)) +
  xlab('residual sugar [g/dm^{3}]') +
  ylab('Density [g/cm^{3}]')  +
  scale_color_brewer(palette = "RdYlBu", name="Quality", direction=-1) +
  theme(panel.background = element_rect(fill = "darkgrey")) +
  guides(color=guide_legend(override.aes = list(alpha = 1))) +
  ggtitle('Plot of Qualiyt, Density and Sugar') 
  
```

*Obersvation*:
The combination of three variable opens a new perspective as you can the influence of the combination of sugar & alcohol on quality.

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_acidity_ph_quality}

# Scatter Plot - Total acidity, pH and Quality
ggplot(aes(x = total.acidity, y = pH), data = enron) +
  geom_point(alpha = 0.5, size = 0.5, position = 'jitter', aes(color = as.factor(quality ))) +
  scale_x_continuous(limits = c(5, 10), breaks = seq(5, 10, 1)) +
  scale_y_continuous(limits = c(2.8, 3.5), breaks = seq(2.8, 3.5, 0.1)) +
  geom_smooth(stat = 'smooth',
              fun.y = mean,
              inetype = 1,
              color = 'red') +
  scale_color_brewer(palette = "RdYlBu", name="Quality",
                     direction=-1)+
  guides(color=guide_legend(override.aes = list(alpha = 1))) +
  xlab('Total acid') +
  ylab('pH') +
  theme(panel.background = element_rect(fill = "darkgrey")) 

```

*Ovbervation*
This plot support our finding that acid and ph has no influence in quality.

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

There seems to be a relation between the combination of sugar and alcohol to qualiry. It also showed that there is moderate realtion between sugar and alcohol.

### Were there any interesting or surprising interactions between features?
It is  suprising to only see a weak realtion between pH and acid value. An interesting finding is that acid and pH has no realtion to quality.

# Final Plots and Summary

I choose to look at three charte about sugar, becaus it was the only feature with a right skerewed distribution.

## Plot One

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_One}

# Histogram 2.0  - Residual sugar
qplot(x = residual.sugar, data = enron, binwidth = 1,
      ylab = 'Number of enrons',
      xlab = 'residual.sugar [g/dm]',
      main = ('Histogram of sugar in enron'), 
      color = I('gray20'),
      fill = I('turquoise')) +
      scale_x_continuous(limits = c(0, 28), breaks = seq(0, 30, 1))
      
```

*Description One*
The histogram shows that most white enrons have less than 2 g/dm sugar. This probaly caused that there are  types of white enron: dry, medium dry, medium sweet and sweet, which are driven by the amount sugar in it.

## Plot Two
```{r echo=FALSE, Plot_Two}

#remove outlier
cleanedenron <-enron[!(enron$residual.sugar > 20 ),]

# Scatter Plot 2.0 - Residual Sugar and Quality
ggplot(aes(x = residual.sugar, y = quality), data = cleanedenron) +
  geom_point(alpha = 0.25, size = 0.8, position = 'jitter') +
  xlab('residual sugar [g/dm^{3}]') +
  ylab('quality')

```

*Description Two*
This scatter plot shows there is only weak relation between sugar and quality, but it seams to reach a quality level of 8 or iher a maximum  sugar is 15 g /dm^{3}. 


## Plot Three
```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Three}

# Scatterplot - Residual Sugar and Density, by Quality Levels
ggplot(aes(x = residual.sugar , y = density), data = cleanedenron) +
  geom_point(data = cleanedenron, alpha = 0.8, aes(color = as.factor(quality ))) +
  scale_x_continuous(limits = c(0, 20), breaks = seq(0, 20, 1)) +
  scale_y_continuous(limits = c(0.985 , 1), breaks = seq(0.985, 1, 1)) +
  xlab('residual sugar [g/dm^{3}]') +
  ylab('Density [g/cm^{3}]')  +
  theme(panel.background = element_rect(fill = "darkgrey")) +
  scale_color_brewer(palette = "RdYlBu", name="Quality",
                     direction=-1)+
  guides(color=guide_legend(override.aes = list(alpha = 1)))
  ggtitle('Plot of Qualiyt, Density and Sugar')
  

```

*Description Three*

It seems that through balance between sugar and alcohol a higher quality level is achieved.

# Reflection

*Reflect on the exploration you performed and insights you found:*
* There is only a weak relation between quality and others enron features. In addition the majority has the quality level 5 and 6. Therefore its hard to differ between white enrons based on their quality.

*What were some of the struggles that you went through?*
* Finding relation between quality and other features.
* In the last plots I had struggle to show  quality as a discrete variable instead a continuous variable. Thanks to the review I was able to change that.

*What went well?*
* The combination of my previous knowledge about such as the relation between sugar and density. * In general the upload of datasets and the download of HTML was easy and sucessful. Furthermore, the creation of simple plots and calculation of the correlation factors.

*What was surprising?*
* That the Quality is ver subjective and its not based on facts. Its only based on qualitative methods instead of qunatitative methods.

*Make sure you include an insight into future work that could be done with the dataset*
* I would like to expand the quality topic. Therefore I would like to explore other parameters, such as price: Is there a correlation between price and quality?
